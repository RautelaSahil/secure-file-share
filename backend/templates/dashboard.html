<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>

<h2>Welcome, {{ username }}</h2>
<a href="/logout">Logout</a>

<hr>

<div style="display:flex; gap:20px">

  <!-- LEFT COLUMN -->
  <div style="width:20%">
    <h3>Options</h3>
    <button disabled>Upload File</button><br><br>
    <button disabled>My Files</button><br><br>
    <button disabled>Shared With Me</button>
  </div>

  <!-- CENTER COLUMN -->
  <div style="width:50%">
    <h3>Upload File</h3>

<form action="/upload" method="POST" enctype="multipart/form-data">
    <input type="file" name="file" required>
    <button type="submit">Upload</button>
</form>

    <p id="uploadStatus"></p>

    <hr>

    <h3>Recently Uploaded</h3>
    <ul id="fileList"></ul>
  </div>

  <!-- RIGHT COLUMN -->
  <div style="width:30%">
    <h3>Shared Files</h3>
    <p>(No shared files yet)</p>
  </div>

</div>

<script>
async function uploadFile() {
  const fileInput = document.getElementById("fileInput");
  const status = document.getElementById("uploadStatus");
  const uploadBtn = document.getElementById("uploadBtn");

  if (!fileInput.files.length) {
    status.innerText = "Please select a file";
    status.style.color = "red";
    return;
  }

  uploadBtn.disabled = true;
  status.innerText = "Uploading...";
  status.style.color = "blue";

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  try {
    const res = await fetch("/api/upload", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    uploadBtn.disabled = false;

    if (res.ok) {
      status.innerText = "Upload successful";
      status.style.color = "green";
      fileInput.value = "";
      loadFiles();
    } else {
      status.innerText = data.error || "Upload failed";
      status.style.color = "red";
    }
  } catch (err) {
    uploadBtn.disabled = false;
    status.innerText = "Network error";
    status.style.color = "red";
  }
}

async function loadFiles() {
  const list = document.getElementById("fileList");
  list.innerHTML = "<li>Loading...</li>";

  try {
    const res = await fetch("/api/files/my");

    if (!res.ok) {
      list.innerHTML = "<li>Error loading files</li>";
      return;
    }

    const files = await res.json();
    list.innerHTML = "";

    if (!files.length) {
      list.innerHTML = "<li>No files uploaded yet</li>";
      return;
    }

    files.forEach(f => {
      const li = document.createElement("li");
      const date = new Date(f.uploaded_at);
      li.innerText = `${f.original_filename} (${date.toLocaleString()})`;
      list.appendChild(li);
    });
  } catch (err) {
    list.innerHTML = "<li>Failed to load files</li>";
  }
}

// Load files on page load
loadFiles();
</script>

</body>
</html>
